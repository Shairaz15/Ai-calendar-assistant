<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Calendar</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(reg => {
                reg.onupdatefound = () => {
                    const installingWorker = reg.installing;
                    installingWorker.onstatechange = () => {
                        if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            if (confirm("New version available! Refresh now?")) window.location.reload();
                        }
                    };
                };
            });
        }
    </script>
</head>

<body>
    <!-- ğŸŒŒ Animated Background -->
    <div class="animated-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="app-container">
        <!-- ğŸŸ¢ Sidebar -->
        <aside class="sidebar glass-panel">
            <div class="logo">âœ¨ AI Calendar</div>

            <nav style="display: flex; flex-direction: column; gap: 1rem;">
                <button id="newEventBtn" class="btn btn-primary" style="width: 100%">+ New Event</button>

                <!-- ğŸ”‘ Auth Section -->
                <div id="authSection">
                    <a href="/auth/google" class="btn"
                        style="background: white; color: black; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; font-size: 0.9rem; width: 100%;">
                        <img src="https://img.icons8.com/color/48/000000/google-logo.png" width="20" height="20"> Login
                        with Google
                    </a>
                </div>
                <div id="userSection" style="display: none;">
                    <div style="color: var(--text-main); font-size: 0.9rem; margin-bottom: 0.5rem;">ğŸ‘¤ Logged In</div>
                    <a href="/auth/logout"
                        style="color: var(--accent-secondary); text-decoration: none; font-size: 0.85rem;">Logout</a>
                </div>

                <div
                    style="color: var(--text-muted); font-size: 0.85rem; margin-top: 1.5rem; text-transform: uppercase; letter-spacing: 1px;">
                    Themes</div>
                <div class="custom-select-wrapper" style="position: relative; width: 100%;">
                    <div class="custom-select glass-input" id="themeSelectTrigger"
                        style="cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                        <span id="currentThemeLabel">ğŸŒŒ Default Dark</span>
                        <span style="font-size: 0.8rem; opacity: 0.7;">â–¼</span>
                    </div>
                    <div class="custom-options glass-panel" id="themeOptions"
                        style="display: none; position: absolute; top: 100%; left: 0; right: 0; z-index: 100; flex-direction: column; gap: 4px; padding: 4px; margin-top: 8px;">
                        <div class="custom-option" data-value="default"
                            onclick="selectTheme('default', 'ğŸŒŒ Default Dark')">ğŸŒŒ Default Dark</div>
                        <div class="custom-option" data-value="red-black"
                            onclick="selectTheme('red-black', 'ğŸ”´ Crimson')">ğŸ”´ Crimson</div>
                        <div class="custom-option" data-value="cyberpunk"
                            onclick="selectTheme('cyberpunk', 'ğŸ¦¾ Cyberpunk')">ğŸ¦¾ Cyberpunk</div>
                        <div class="custom-option" data-value="minimal"
                            onclick="selectTheme('minimal', 'ğŸ“„ Minimal Light')">ğŸ“„ Minimal Light</div>
                    </div>
                </div>

                <div
                    style="color: var(--text-muted); font-size: 0.85rem; margin-top: 1.5rem; text-transform: uppercase; letter-spacing: 1px;">
                    Tools</div>
                <button id="sidebarFocusBtn" class="btn"
                    style="width: 100%; background: linear-gradient(135deg, #10b981, #059669); color: white;">
                    ğŸ§˜ Focus Mode
                </button>

                <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 0.5rem;">
                    <div
                        style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-size: 0.9rem;">
                        <span
                            style="width: 10px; height: 10px; background: var(--accent-primary); border-radius: 50%; box-shadow: 0 0 10px var(--accent-glow);"></span>
                        <span>Personal</span>
                    </div>
                    <div
                        style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-size: 0.9rem;">
                        <span
                            style="width: 10px; height: 10px; background: var(--accent-secondary); border-radius: 50%; box-shadow: 0 0 10px var(--accent-secondary-glow);"></span>
                        <span>Work</span>
                    </div>
                </div>

                <div
                    style="color: var(--text-muted); font-size: 0.85rem; margin-top: 1.5rem; text-transform: uppercase; letter-spacing: 1px;">
                    Habits</div>
                <div id="habitList" style="display:flex; flex-direction:column; gap:10px;"></div>
            </nav>
        </aside>

        <!-- ğŸ“… Main Calendar -->
        <main class="calendar-main glass-panel">
            <header class="calendar-header">
                <h2 id="currentMonthStr">December 2025</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="glass-input" id="prevMonthBtn"
                        style="padding: 10px 16px; cursor: pointer;">â€¹</button>
                    <button class="glass-input" id="nextMonthBtn"
                        style="padding: 10px 16px; cursor: pointer;">â€º</button>
                </div>
            </header>

            <div class="calendar-grid" id="calendarGrid">
                <div class="day-header">Sun</div>
                <div class="day-header">Mon</div>
                <div class="day-header">Tue</div>
                <div class="day-header">Wed</div>
                <div class="day-header">Thu</div>
                <div class="day-header">Fri</div>
                <div class="day-header">Sat</div>
            </div>
        </main>
    </div>

    <!-- ğŸ¤– Floating AI Assistant Bubble -->
    <aside class="assistant-panel glass-panel" id="assistantPanel">
        <span class="bubble-icon">ğŸ¤–</span>

        <div class="panel-content">
            <div class="assistant-header">
                <h3>AI Assistant</h3>
                <button class="close-panel-btn" id="closePanelBtn" title="Close">âœ•</button>
            </div>

            <div id="aiLog">
                <div class="chat-message ai">ğŸ‘‹ Hi! I'm your scheduling assistant. Try: "Meeting tomorrow at 3pm"</div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>

            <div class="ai-input-wrapper">
                <button id="voiceBtn" class="voice-btn" title="Speak command">ğŸ¤</button>
                <input type="text" class="glass-input ai-input" id="eventInput" placeholder="Type or speak...">
                <button class="send-btn" id="sendBtn">â¤</button>
            </div>
        </div>
    </aside>

    <!-- ğŸ§˜ Focus Modal -->
    <div id="focusModal" class="modal-overlay">
        <div class="glass-panel modal-content">
            <h2>ğŸ§˜ Focus Mode</h2>
            <div id="timerDisplay"
                style="font-size: 4rem; font-weight: 700; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 2rem 0;">
                25:00
            </div>
            <div style="display:flex; gap:1rem; justify-content:center; flex-wrap: wrap;">
                <button class="btn btn-primary" id="startTimerBtn">Start 25m</button>
                <button class="btn" id="startBreakBtn" style="background:rgba(16, 185, 129, 0.2); color:#10b981;">â˜• 5m
                    Break</button>
                <button class="btn" id="stopTimerBtn" style="background:rgba(255,255,255,0.1);">Stop</button>
                <button class="btn" id="closeModalBtn" style="background:rgba(255,255,255,0.1);">Close</button>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š Dashboard Modal -->
    <div id="dashboardModal" class="modal-overlay">
        <div class="glass-panel modal-content">
            <h2>ğŸ“Š Productivity Stats</h2>
            <div id="statsContent" style="margin: 2rem 0; line-height: 1.8;">
                Loading stats...
            </div>
            <button class="btn" id="closeDashBtn" style="background:rgba(255,255,255,0.1);">Close</button>
        </div>
    </div>

    <!-- ğŸ“ Manual Event Modal -->
    <div id="manualEventModal" class="modal-overlay">
        <div class="glass-panel modal-content" style="text-align:left;">
            <h2 style="text-align:center; margin-bottom:1.5rem;">ğŸ“… New Event</h2>

            <label style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">Event
                Title</label>
            <input type="text" id="manualTitle" class="glass-input" style="width:100%; margin-bottom:1rem;"
                placeholder="e.g. Lunch with Mom">

            <label
                style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">Date</label>
            <input type="date" id="manualDateOnly" class="glass-input" style="width:100%; margin-bottom:1rem;">

            <div style="display:flex; gap:1rem;">
                <div style="flex:1;">
                    <label
                        style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">Start
                        Time</label>
                    <input type="time" id="manualStartTime" class="glass-input"
                        style="width:100%; margin-bottom:1.5rem;">
                </div>
                <div style="flex:1;">
                    <label style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">End
                        Time</label>
                    <input type="time" id="manualEndTime" class="glass-input" style="width:100%; margin-bottom:1.5rem;">
                </div>
            </div>

            <div style="display:flex; gap:1rem; justify-content:center;">
                <button class="btn btn-primary" id="saveEventBtn">Save Event</button>
                <button class="btn" id="closeManualBtn" style="background:rgba(255,255,255,0.1);">Cancel</button>
            </div>
        </div>
    </div>

    <!-- âœï¸ Edit Event Modal -->
    <div id="editEventModal" class="modal-overlay">
        <div class="glass-panel modal-content" style="text-align:left;">
            <h2 style="text-align:center; margin-bottom:1.5rem;">âœï¸ Edit Event</h2>

            <input type="hidden" id="editEventId">

            <label style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">Event
                Title</label>
            <input type="text" id="editTitle" class="glass-input" style="width:100%; margin-bottom:1rem;">

            <label style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">Start
                Time</label>
            <input type="datetime-local" id="editDate" class="glass-input" style="width:100%; margin-bottom:1rem;">

            <label style="font-size:0.9rem; color:var(--text-muted); display: block; margin-bottom: 0.5rem;">End
                Time</label>
            <input type="datetime-local" id="editEndDate" class="glass-input" style="width:100%; margin-bottom:1.5rem;">

            <div style="display:flex; gap:1rem; justify-content:center;">
                <button class="btn btn-primary" id="updateEventBtn">Update</button>
                <button class="btn" id="deleteFromEditBtn"
                    style="background:rgba(239, 68, 68, 0.3); color:#ef4444;">Delete</button>
                <button class="btn" id="closeEditBtn" style="background:rgba(255,255,255,0.1);">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ğŸ—‘ï¸ Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal-overlay">
        <div class="glass-panel modal-content">
            <h2>ğŸ—‘ï¸ Delete Event?</h2>
            <p id="deleteConfirmText" style="margin: 1.5rem 0; color: var(--text-muted);">Are you sure you want to
                delete this event?</p>
            <div style="display:flex; gap:1rem; justify-content:center;">
                <button class="btn" id="confirmDeleteBtn"
                    style="background:rgba(239, 68, 68, 0.3); color:#ef4444;">Delete</button>
                <button class="btn" id="cancelDeleteBtn" style="background:rgba(255,255,255,0.1);">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ğŸŒ Day View Modal -->
    <div id="dayViewModal" class="modal-overlay">
        <div class="glass-panel modal-content"
            style="width: 500px; padding:0; text-align:left; height: 80vh; display:flex; flex-direction:column;">
            <div
                style="padding: 1.5rem; border-bottom: 1px solid var(--glass-border); display:flex; justify-content:space-between; align-items:center;">
                <h2 id="dayViewDate" style="font-size:1.2rem;">Date</h2>
                <button class="btn" id="closeDayViewBtn"
                    style="background:rgba(255,255,255,0.1); padding: 8px 16px;">Close</button>
            </div>

            <div id="dayTimeline" style="flex:1; overflow-y:auto; position:relative; padding: 1rem;"></div>
        </div>
    </div>

    <!-- ğŸ“‹ Context Menu -->
    <div id="contextMenu" class="context-menu glass-panel" style="display:none;">
        <div class="context-menu-item" data-action="edit">âœï¸ Edit</div>
        <div class="context-menu-item" data-action="delete">ğŸ—‘ï¸ Delete</div>
        <div class="context-menu-item" data-action="duplicate">ğŸ“‹ Duplicate</div>
    </div>

    <script src="script.js"></script>
</body>

</html>